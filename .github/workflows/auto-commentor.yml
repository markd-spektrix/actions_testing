name: Auto PR Commentor
run-name: Adding Comments to PR
on: pull_request
jobs:
  terraform:
    runs-on: ubuntu-latest
    permissions:
        pull-requests: write

    steps:
      - uses: actions/checkout@v3
      
      - uses: hashicorp/setup-terraform@v2
      
      - name: Terraform fmt
        id: fmt
        run: terraform fmt -check
        continue-on-error: true
      
      - name: Terraform Init
        id: init
        run: terraform init
      
      - name: Terraform Validate
        id: validate
        run: terraform validate -no-color
      
      - name: Terraform Plan
        id: plan
        run: terraform plan -no-color
        continue-on-error: true
        
      - name: Add comment
        run: gh pr comment "$NUMBER" --repo "$REPO" --body "$BODY"
        env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
            NUMBER: ${{ github.event.pull_request.number }}
            REPO: ${{ github.repository }}
            BODY: >
              _Pusher: @${{ github.actor }}, Workflow: `${{ github.workflow }}`_
  
              #### Terraform Format and Style 🖌 `${{ steps.fmt.outcome }}`

              #### Terraform Initialization ⚙️`${{ steps.init.outcome }}`
              
              #### Terraform Validation 🤖`${{ steps.validate.outcome }}`
        
              #### Terraform Plan 📖`${{ steps.plan.outcome }}`
        
              <details><summary>Show Plan</summary> 
              

              ```

              ${{steps.plan.outputs.stdout}}              
              
              ```
        
              </details>
              
              
